SELECT * FROM Airbnb;
go

--Data Cleaning

--Removing unwanted columns
ALTER TABLE Airbnb
DROP COLUMN id, zipcode
GO
--Renaming the log_price to Room_price
 EXEC sp_rename 'Airbnb.log_price','RoomPrice','column'
 GO
--Rounding up the Roomprice to 2 decimal place
UPDATE 
	Airbnb 
SET 
	RoomPrice =
		ROUND(RoomPrice,2) from Airbnb
GO

--Replacing the city name abbrevations with their full names
UPDATE Airbnb
SET city = 
	CASE 
		WHEN city = 'LA' THEN 'Los Angeles'
		WHEN city = 'NYC' THEN 'New York City'
		WHEN city = 'SF' THEN 'San-Francisco' 
		WHEN city = 'DC' THEN 'Washington DC'
		ELSE city
		END

--Updating the bathroom data type from float to smallint
ALTER TABLE Airbnb
ALTER COLUMN bathrooms SMALLINT 

SELECT * FROM Airbnb

--QUESTIONS AND ANSWERS

-- What is the total count of Airbnb services
SELECT COUNT(*) FROM Airbnb

--How many Cities are covered
SELECT DISTINCT city FROM Airbnb

--How many Airbnb services are present in each City
SELECT 
	city, COUNT(*) AS AirbnbService
FROM 
	Airbnb 
GROUP BY 
	city
ORDER BY 
	AirbnbService DESC

--What is the average roomprice per City
SELECT 
	city, ROUND(AVG(RoomPrice),2) AS AverageRoomPrice 
FROM 
	Airbnb
GROUP BY
	city
ORDER BY 
	AverageRoomPrice DESC

--what city generated the most revenue
SELECT 
	city, ROUND(SUM(RoomPrice),2) AS TotalPrice 
FROM 
	Airbnb
GROUP BY
	city
ORDER BY 
	TotalPrice DESC


--What is the most used property_type
SELECT 
	property_type, COUNT(*) MostUsedPropertyType
FROM 
	Airbnb 
GROUP BY 
	property_type
ORDER BY
	MostUsedPropertyType DESC

-- Most used roomtype
SELECT 
	room_type, COUNT(*) MostUsedRoomType
FROM 
	Airbnb 
GROUP BY 
	room_type
ORDER BY
	MostUsedRoomType DESC



--average number of persons per city
select 
city,ROUND(AVG(accommodates),0)
from 
	Airbnb 
GROUP BY 
	city

--what city and property type has the highest roomprice
select * from Airbnb

WITH ranked_prices AS (
    SELECT 
		city
		,property_type
		,roomprice
        ,RANK() OVER (PARTITION BY city ORDER BY roomprice DESC) AS price_rank
    FROM 
		Airbnb )
SELECT 
	 city,property_type,(roomprice)
FROM 
	ranked_prices
WHERE 
	price_rank = 1
ORDER BY 
	roomprice DESC


--average number of persons per property_type in NewYork

select  
	property_type, ROUND(AVG(accommodates),0) AverageNumberofPersons 
from 
	Airbnb
where 
	city = 'New York City'
group by 
	property_type
ORDER BY
	AverageNumberofPersons DESC

--What year has the most first_review and how much was generated by each city in the year

SELECT TOP 1 Years, MAX(totalreview) AS YearWithMostReview
FROM (
    SELECT YEAR(first_review) AS Years, count(first_review) AS totalreview
    FROM Airbnb
    GROUP BY YEAR(first_review)
) AS mx
GROUP BY Years
ORDER BY YearWithMostReview DESC;

select   
	YEAR(first_review) as Years, sum(RoomPrice)TotalRoomPrice, city
from 
	Airbnb 
where 
	YEAR(first_review) = 2016  
group by 
	year(first_review), city 

